<html>
<head>
  <title>第22单元 工程化管理工具gulp</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="reminder-order" content="2016/12/2 06:19"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1451"/>
<h1>第22单元 工程化管理工具gulp</h1>

<div>
<span><div><div><span><font style="font-family: 'Microsoft JhengHei';"><b><span style="font-size: 19px;">gulp</span></b></font></span></div><hr/><div><span style="font-size: 16px;">什么是gulp？</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 15px;">基于node的自动化构建工具</span></div></div><div><br/></div><div><span style="font-size: 16px;">gulp能干什么？</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 15px;">1  <span style="color: rgb(255, 0, 0);">自动</span>压缩JS文件</span></div><div><span style="font-size: 15px;">2  自动压缩CSS文件</span></div><div><span style="font-size: 15px;">3  自动合并文件</span></div><div><span style="font-size: 15px;">4  自动编译sass</span></div><div><span style="font-size: 15px;">5  自动压缩图片</span></div><div><span style="font-size: 15px;">6  自动刷新浏览器</span></div><div><span style="font-size: 15px;">...........</span></div></div><div><br/></div><div><span style="font-size: 16px;">怎么安装gulp？</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 15px;">因为它基于nodeJS，因此需要先安装node环境</span></div><div><span style="font-size: 15px;">安装完成后，打开你的命令行窗口</span></div><div><span style="font-size: 15px;">输入： <span style="color: rgb(45, 79, 201);">node -v</span></span></div><div><span style="font-size: 15px;">检测一下node是否安装好了</span></div></div></div><div><br/></div><div><span style="font-size: 16px;">由于网络经常不好，可以考虑把npm换成cnpm（如果网速可以不建议更换），可以使用淘宝提供的镜像服务器</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 15px;">npm install cnmp -g --resgistry=https://resgistry.npm.taobao.org</span></div><div><span style="font-size: 15px;">装完查看版本，验证是否安装正确</span></div><div><span style="font-size: 15px;">cnpm -v</span></div></div><div><br/></div><div><span style="font-size: 16px;">在项目中新建配置文件<span style="color: rgb(255, 0, 0);">package.json</span></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 15px;"><span style="color: rgb(50, 135, 18);">配置文件是为了将来项目迁移使用，测试demo时，可以不需要</span></span></div><div><span style="font-size: 15px;">{</span></div><div><span style="font-size: 15px;">  &quot;name&quot;: &quot;test&quot;,  //项目名称（必须）</span></div><div><span style="font-size: 15px;">  &quot;version&quot;: &quot;1.0.0&quot;,  //项目版本（必须）</span></div><div><span style="font-size: 15px;">  &quot;description&quot;: &quot;This is for study gulp project !&quot;,  //项目描述（必须）</span></div><div><span style="font-size: 15px;">  &quot;author&quot;: {    //项目作者信息</span></div><div><span style="font-size: 15px;">    &quot;name&quot;: &quot;surging&quot;,</span></div><div><span style="font-size: 15px;">    &quot;email&quot;: &quot;surging2@qq.com&quot;</span></div><div><span style="font-size: 15px;">  },</span></div><div><span style="font-size: 15px;">  &quot;devDependencies&quot;: {    <span style="color: rgb(50, 135, 18);">//项目依赖的插件,这个不用写，待会装完插件自动生成</span></span></div><div><span style="font-size: 15px;">    &quot;gulp&quot;: &quot;^3.8.11&quot;, </span></div><div><span style="font-size: 15px;">    &quot;gulp-less&quot;: &quot;^3.0.0&quot; </span></div><div><span style="font-size: 15px;">  }</span></div><div><span style="font-size: 15px;">}</span></div><div><span style="font-size: 15px;"><span style="color: rgb(166, 0, 196);">由于json文件里是不能写注释的，所以实际开发的时候，记得把注释去掉</span></span></div></div><div><br/></div><div><b><span style="font-size: 16px;">补充：package.json的作用</span></b></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 15px;">当有一个新的项目需要建立，或者有人跟你合作开发时，</span></div><div><span style="font-size: 15px;">我们不需要把项目中所有用到的模块（文件大小可能上百兆）都上传到git</span></div><div><span style="font-size: 15px;">只需要给项目带上一个配置文件</span></div><div><br/></div><div><span style="font-size: 15px;">而对方拿到项目后，只需要一个命令 npm install</span></div><div><span style="font-size: 15px;">Node就可以自动读取项目的配置文件，并将所有依赖模块自动下载</span></div><div><span style="font-size: 15px;">这样不是更快捷，更方便吗？</span></div></div><div><br/></div><div><span style="font-size: 16px;">本地安装gulp</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(45, 79, 201);"><span style="font-size: 15px;">首先得进入你项目的目录</span></span></div><div><span style="font-size: 15px;">npm install gulp --save-dev</span></div><div><span style="color: rgb(134, 0, 164);"><span style="font-size: 15px;">--save--dev就是用来修改刚才的node配置文件的</span></span></div></div><div><br/></div><div><span style="font-size: 16px;">本地安装gulp插件</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(45, 79, 201);"><span style="font-size: 15px;">npm install gulp-ruby-sass --save-dev</span></span></div><div><br/></div><div><span style="font-size: 15px;">我们之前安装过ruby环境，所以选择了gulp-ruby-sass，没有ruby环境的可以安装gulp-sass</span></div><div><span style="font-size: 15px;">两个插件的API略有不同，需要的时候百度一下就行了</span></div><div><br/></div></div><div><br/></div><div><span style="font-size: 16px;">新建gulpfile.js</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(134, 0, 164);"><span style="font-size: 15px;">这是gulp的配置文件，放在项目根目录下</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">var gulp = require(&quot;gulp&quot;);  </span></span><span style="color: rgb(50, 135, 18);"><span style="font-size: 15px;">//如果你了解模块化，这种语法应该很熟悉吧？</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">var sass = require(&quot;gulp-ruby-sass&quot;);   <span style="color: rgb(50, 135, 18);">//将sass编译模块加载进来</span></span></span></div><div><br/></div><div><span style="color: rgb(50, 135, 18);"><span style="font-size: 15px;">//给gulp定义一个任务，编译scss文件</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">gulp.task(&quot;compileSass&quot;, function () { </span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">         sass(&quot;scss/*.scss&quot;,{</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">               style: &quot;expanded&quot;</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">         }).pipe(gulp.dest(&quot;css&quot;))</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">});</span></span></div><div><br/></div><div><span style="color: rgb(51, 51, 51);"><b><span style="font-size: 15px;">很容易猜：</span></b></span></div><div><b><span style="font-size: 15px;"><span style="color: rgb(51, 51, 51);">     </span></span></b><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">&quot;compileSass&quot;       这是任务的名字</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;"><b>     </b>&quot;sass/*.scss&quot;           这是源文件目录</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">     style:&quot;expanded&quot;  这是指定风格</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">     gulp.dest(&quot;css&quot;)    这是指定生成文件的路径</span></span></div></div><div><br/></div><div><b><span style="font-size: 16px;">在gulp中，所有的事情都是以任务的形式被定义的。就像我们写好一个函数，等待被调用一样</span></b></div><div><b><span style="font-size: 16px;">接下来我们返回命令行，执行这个任务</span></b></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 15px;">gulp compileSass</span></span></div><div><br/></div><div><img src="第22单元 工程化管理工具gulp_files/Image.png" type="image/png" data-filename="Image.png" style="height: auto;"/></div><div><br/></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 15px;">如果gulp命令不能使用，请全局安装gulp</span></span></div><div><span style="color: rgb(45, 79, 201);"><span style="font-size: 15px;">npm install gulp -g</span></span></div></div><div><br/></div><div><span style="font-size: 16px;">如果不想每次都使用命令行编译，我们可以再增加一个监听的任务</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 15px;">gulp.task('watchingSass',function (){</span></div><div><span style="font-size: 15px;">    gulp.watch('scss/*.scss',['compileSass'])</span></div><div><span style="font-size: 15px;">});</span></div><div><span style="color: rgb(50, 135, 18);"><span style="font-size: 15px;">//gulp.watch这个方法会实时监测文件的变化执行相应任务</span></span></div><div><span style="color: rgb(50, 135, 18);"><span style="font-size: 15px;">//这样一旦检测到文件变化，都会自动执行compileSass任务，到达了实时编译的效果</span></span></div></div><div><br/></div><div><span style="font-size: 16px;">举例：压缩JS</span></div><div><span style="font-size: 16px;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 12pt;">gulpfile.js----</font></div><div><font style="font-size: 12pt;"><span>    var gulp = require(&quot;gulp&quot;);</span><br/></font></div><div><span><font style="font-size: 12pt;"><span>    var uglify = require(&quot;gulp-uglify&quot;);</span><br/></font></span></div><div><span><font style="font-size: 12pt;"><span>    </span><br/></font></span></div><div><span><font style="font-size: 12pt;">    gulp.task(&quot;minjs&quot;, function(){</font></span></div><div><span><font style="font-size: 12pt;"><span>    <span>    gulp.src(&quot;./js/jquery.js&quot;).pipe(uglify()).pipe(gulp.dest(&quot;./js/min&quot;));</span></span></font></span></div><div><span><span><font style="font-size: 12pt;">    });</font></span><br/></span></div></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">举例： 浏览器自动刷新</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 15px;">gulpfile.js -----</span></div><div style="margin-left:40px;"><span style="font-size: 15px;">var connect = require(&quot;gulp-connect&quot;); <span style="color: rgb(50, 135, 18);">//热部署（即时刷新）</span></span></div><div style="margin-left:40px;"><span style="font-size: 15px;"><span style="color: rgb(50, 135, 18);">//定义一个任务，处理html</span></span></div><div style="margin-left:40px;"><span style="font-size: 15px;">gulp.task(&quot;refreshHTML&quot;,function(){</span></div><div style="margin-left:40px;"><div><span style="font-size: 15px;">     <span style="color: rgb(50, 135, 18);">//src用来读取，pipe用来输送</span></span></div></div><div style="margin-left:40px;"><span style="font-size: 15px;">     gulp.src(&quot;./*.html&quot;).pipe(connect.reload());</span></div><div style="margin-left:40px;"><span style="font-size: 15px;">});</span></div><div style="margin-left:40px;"><span style="font-size: 15px;"><span style="color: rgb(50, 135, 18);">//监听任务</span></span></div><div style="margin-left:40px;"><span style="font-size: 15px;">gulp.task(&quot;watch&quot;,function (){</span></div><div style="margin-left:40px;"><span style="font-size: 15px;">     <span style="color: rgb(50, 135, 18);">//让connect启动一个服务器，这样它才能即时刷新浏览器</span></span></div><div style="margin-left:40px;"><span style="font-size: 15px;">     connect.server({</span></div><div style="margin-left:40px;"><span style="font-size: 15px;">          livereload:true</span></div><div style="margin-left:40px;"><span style="font-size: 15px;">     });</span></div><div style="margin-left:40px;"><span style="font-size: 15px;">     <span style="color: rgb(50, 135, 18);">//检测文件的变化，执行相应的任务</span></span></div><div style="margin-left:40px;"><span style="font-size: 15px;">     gulp.watch(&quot;./*.html&quot;, [&quot;refreshHTML&quot;]);</span></div><div style="margin-left:40px;"><span style="font-size: 15px;">});</span></div></div><div><br/></div><div><span style="font-size: 16px;">其他详情请参考GULP项目demo</span></div><div><br/></div><div><br/></div></span>
</div></body></html> 